
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>予約承認する</title>
<link rel="stylesheet" href="/css/Reservation.css">
</head>
<header class="header">
</header>

<h2 class="ScreenTitle">予約承認画面</h2>

<!-- エラーメッセージ表示 -->
<p th:if="${errorMessage}" th:text="${errorMessage}" style="color:red"></p>

<table>
    <tr>
      <th>書名(タイトル)</th>
      <th class="publisherdisplay">出版社</th>
      <th>冊</th>
      <th class="namedisplay">名前</th>
    </tr>
    <tr>
      <td id="title" class="data-cell" th:text="${title}"></td>
      <td id="publisher" class="data-cell" th:text="${publisher}"></td>
      <td id="count" class="data-cell" th:text="${count}"></td>
      <td id="name" class="data-cell" th:text="${name}"></td>

    </tr>
  </table>
  
  <br>
  
  <!-- 変更可能な入力フォーム -->
  <!--<form method="get" action="orderhistory.html" id="approvalForm">-->
    <form method="post" action="/reserveappro" id="approvalForm" onsubmit="return validateAndSubmit(this)">

      <!-- CSRFトークン追加 -->
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    
    <table>
      <tr>
        <th class="Required" colspan="4">下記項目は必須入力です</th>
      </tr>
      <tr>
        <th>ISBNコード</th>
        <td><input type="text" name="isbnCode" /></td>
      </tr>
      <tr>
        <th>書名(タイトル)</th>
        <td><input type="text" name="title" /></td>
      </tr>
      <tr>
        <th>出版社</th>
        <td><input type="text" name="publisher" /></td>
      </tr>
      <tr>
        <th class="Required" colspan="4">下記項目は必須入力です</th>
      </tr>
      <tr>
        <!--<th>冊数</th>
        <td><input type="text" name="count" /></td>-->
      </tr>
      <tr>
        <th>金額</th>
        <td><input type="text" name="amountInput" /></td>
      </tr>
    </table>
  
    <!-- hiddenで送信するフィールド -->
    <input type="hidden" name="approvalDate" id="approvalDate" />
    <input type="hidden" name="amount" />
    <input type="hidden" name="approvalStatus" value="承認済み" />
  
    <button type="submit">承認する</button>
    <button type="button" onclick="location.href='/orderhistory'">注文履歴に戻る</button>
  </form>
  
  <script>
    function calculateAmountAndSubmit(form) {
        const unitPrice = parseFloat(form.amountInput.value);
        const count = parseInt(document.getElementById("count")?.textContent || 1); // デフォルト1冊
    
        if (!isNaN(unitPrice) && !isNaN(count)) {
            form.amount.value = unitPrice * count;
    
            // 承認日セット（yyyy-mm-dd）
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById("approvalDate").value = `${yyyy}-${mm}-${dd}`;
    
            // フォーム送信
            //form.submit();
            return true;
        } else {
            alert("金額または冊数が無効です。");
            return false; // 無効 → 送信しない、そのまま画面
        }
    }
    </script>
    